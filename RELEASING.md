# Releasing

1. Checkout the `dev` branch.

2. If changes intended for release exist in branches other than `dev`, merge them into `dev`.

3. Bump the project version with `poetry version`. If necessary, check the most recently published version of the
   project with `gh release view --json tagName`.

4. Run `python --version`. Ensure the `FROM` statement in the
   [`Dockerfile`](Dockerfile) is pulling an image with the same Python version.

5. Run `poetry --version` (note the double dash). Ensure the `POETRY_VERSION` environment variable in
   the [`Dockerfile`](Dockerfile) is set to the same version.

6. Commit any uncommitted changes to the `dev` branch and pull any remote ones.

7. Run `kurisu copyright`. Commit any resulting changes.

8. Run `pre-commit run --all-files`. Commit any resulting changes. Repeat until all pre-comit hooks pass.

9. Start 3515.games.dev via [`src/main.py`](src/main.py). Ensure the bot successfully starts, runs, and responds to user
   interaction, then stop it.

10. Build and run 3515.games.dev's Docker image via [`dockerfile.sh`](dockerfile.sh). Ensure the Docker image
    builds
    and that the bot successfully starts, runs, and responds to user interaction, then stop it.

11. Write an entry in [`CHANGELOG.md`](CHANGELOG.md) for the new version if you haven't already. Thoroughly check the
    new changelog entry for any typos or notable omissions, as it will be inconvenient to fix them after this step.

12. If there are still remaining uncommitted changes to `dev`, commit them.

13. Create a new **pre**-release on GitHub with `gh release create`. The release tag and title should be the new
    version number _exactly_ as it appears in [`pyproject.toml`](pyproject.toml). Use the release notes generated by
    `kurisu notes`. **It is very important that you mark it as a pre-release!**

14. Push the `dev` branch to GitHub.

15. Open a pull request from `dev` to `main`. If there are no conflicts (and there better not be), merge it.

16. Place 3515.games in maintenance mode.

17. When you're ready to go live, publish the pre-release you created in step 12 and create a new deployment
    on [Railway](https://railway.app).
